<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="setting">
	<!-- 获得读取文件设置信息 -->
	<select id="getSetting" resultClass="SettingManageBean" parameterClass="java.util.Map">
		  SELECT  
				SETID AS settingId,
				SYSTEMID AS systemCode,
				FILEPATH AS path,
				FILENAME AS fileName,
				STARTFLAG AS startFlag,
				SPLITSTR AS splitStr,
				DEALID AS dealId,
				SERIALNUMBER AS serialNumber,
				TRANSACOUNT AS transaCount,
				TERMINALID AS terminalCode,
				DEALDATA AS dealData,
				DEALTIME AS dealTime,
				DEALSTATUS AS dealStatus,
				DEALTYPE AS dealtypeId,
				DEALDESC AS dealDesc,
				DEALREBACKCODE AS dealRebackCode,
				BANKCARDNUMBER AS bankCardnumber,
				COST AS cost,
				MERCHANTCODE AS merchantCode,
				SETTINGSTATUS AS settingStatus,
	  CASE WHEN SETTINGSTATUS='1' THEN '有效' ELSE '无效' END AS settingStatusStr,
				SETTINGDESC AS settingDesc,
		 		getUserNameById(CREATEID) as createrId,
				CREATEDT AS createDate
		   FROM QT1TBLSETTING 
		  WHERE 1=1
		 <isNotEmpty property="systemCode">
			AND SYSTEMID=#systemCode#
		 </isNotEmpty>
		 
		 <isNotEmpty property="status">
			AND SETTINGSTATUS=#status#
		 </isNotEmpty>
		order by CREATEDT desc
	</select>
	
	<!-- 获取文件路径 -->
	<select id="getFilePath" resultClass="SettingManageBean">
			SELECT  
				S.SETID AS settingId,
				S.SYSTEMID AS systemCode,
				T.SYSTEMNAME AS systemName,
				S.FILEPATH AS path,
				S.FILENAME AS fileName,
				S.STARTFLAG AS startFlag,
				S.SPLITSTR AS splitStr,
				S.DEALID AS dealId,
				S.SERIALNUMBER AS serialNumber,
				S.TRANSACOUNT AS transaCount,
				S.TERMINALID AS terminalCode,
				S.DEALDATA AS dealData,
				S.DEALTIME AS dealTime,
				S.DEALSTATUS AS dealStatus,
				S.DEALTYPE AS dealtypeId,
				S.DEALDESC AS dealDesc,
				S.DEALREBACKCODE AS dealRebackCode,
				S.BANKCARDNUMBER AS bankCardnumber,
				S.COST AS cost,
				MERCHANTCODE AS merchantCode,
				S.SETTINGSTATUS AS settingStatus,
	  CASE WHEN S.SETTINGSTATUS='1' THEN '有效' ELSE '无效' END AS settingStatusStr,
	  CASE WHEN S.STARTFLAG='1' THEN '是' ELSE '否' END AS startFlagStr,
				S.SETTINGDESC AS settingDesc,
		 		getUserNameById(S.CREATEID) as createrId,
				S.CREATEDT AS createDate
		   FROM QT1TBLSETTING S ,QT1TBLSYSTEM T
		  WHERE 1=1
		    AND SETTINGSTATUS = '1'
		    AND S.SYSTEMID=T.SYSTEMID
	</select>

	<!-- 添加读取文件设置信息 -->
	 <insert id="addSetting" parameterClass="SettingManageBean">
		INSERT INTO QT1TBLSETTING(
				SETID,
				SYSTEMID,
				FILEPATH,
				FILENAME,
				STARTFLAG,
				SPLITSTR,
				DEALID,
				SERIALNUMBER,
				TRANSACOUNT,
				TERMINALID,
				DEALDATA,
				DEALTIME,
				DEALSTATUS,
				DEALTYPE,
				DEALDESC,
				DEALREBACKCODE,
				BANKCARDNUMBER,
				COST,
				MERCHANTCODE,
				SETTINGSTATUS,
				SETTINGDESC,
				CREATEID,
				CREATEDT
			  )
		VALUES(
				#settingId#,
				#systemCode#,
				#path#,
				#fileName#,
				#startFlag#,
				#splitStr#,
				#dealId#,
				#serialNumber#,
				#transaCount#,
				#terminalCode#,
				#dealData#,
				#dealTime#,
				#dealStatus#,
				#dealtypeId#,
				#dealDesc#,
				#dealRebackCode#,
				#bankCardnumber#,
				#cost#,
				#merchantCode#,
				#settingStatus#,
				#settingDesc#,
				#createrId#,
				#createDate#
			  )
	</insert>
	
	<!-- 编辑读取文件设置信息 -->
	<update id="updateSetting" parameterClass="SettingManageBean">
		UPDATE
		QT1TBLSETTING SET
			SYSTEMID=#systemCode#,
			FILEPATH=#path#,
			FILENAME=#fileName#,
			DEALID=#dealId#,
			STARTFLAG=#startFlag#,
			SPLITSTR=#splitStr#,
			SERIALNUMBER=#serialNumber#,
			TRANSACOUNT=#transaCount#,
			TERMINALID=#terminalCode#,
			DEALDATA=#dealData#,
			DEALTIME=#dealTime#,
			DEALSTATUS=#dealStatus#,
			DEALTYPE=#dealtypeId#,
			DEALDESC=#dealDesc#,
			DEALREBACKCODE=#dealRebackCode#,
			BANKCARDNUMBER=#bankCardnumber#,
			COST=#cost#,
			MERCHANTCODE=#merchantCode#,
			SETTINGSTATUS=#settingStatus#,
			SETTINGDESC=#settingDesc#
		WHERE
		SETID=#settingId#
	</update>
	
	<!-- 删除读取文件设置信息 -->
	<update id="deleteSetting" parameterClass="java.lang.String">
		UPDATE
		QT1TBLSETTING SET
		SETTINGSTATUS='0' where SETID in($settingIds$)
	</update>
</sqlMap>
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="mould">

	<!-- 获得顶级分润模板信息 -->
	<select id="getTopMoulds" resultClass="SplitTopMouldBean"
		parameterClass="java.util.Map">
		SELECT
		DISTINCT
		AGENCY_ID AS agencyId,
		GETAGENCYNAMEBYID(AGENCY_ID) AS agencyName，
		RULE_ID AS ruleId,
		RULEREM AS ruleRem,
		MOULD_NAME AS MouldName
		FROM QT1TBLTOPTMPT
		WHERE AGENCY_ID = #agencyId#
		<isNotEmpty property="mouldName">
			AND MOULD_NAME=#mouldName#
		</isNotEmpty>
		AND STATUS ='1'
	</select>

	<!-- 获得顶级分润模板信息 (通过agencyId,和ruleId) -->
	<select id="getTopMouldByAR" resultClass="SplitTopMouldBean"
		parameterClass="java.util.Map">
		SELECT
		DISTINCT
		AGENCY_ID AS agencyId,
		GETAGENCYNAMEBYID(AGENCY_ID) AS agencyName,
		RULE_ID AS ruleId,
		RULEREM AS ruleRem,
		MOULD_NAME AS MouldName,
		STATUS AS status
		FROM QT1TBLTOPTMPT
		WHERE AGENCY_ID IN
		( SELECT AGENCY_ID FROM rtb_qt1tblagency
		START WITH AGENCY_ID=#agencyId#
		CONNECT BY PRIOR ONLINECHANNEL=AGENCY_ID)
		AND RULE_ID=#ruleId#

	</select>

	<!--上级机构 根据机构编号获得自己的模板名称 -->
	<select id="getTopMouldList" resultClass="SplitTopMouldBean"
		parameterClass="java.util.Map">
		SELECT
		DISTINCT
		MOULD_NAME AS mouldName
		FROM QT1TBLORGSPLITTMPT
		WHERE AGENCY_ID = #agencyId#
		AND MOULD_NAME != #noName#
	</select>

	<!-- 顶级机构根据机构编号获得自己的模板名称 -->
	<select id="topGetMouldList" resultClass="SplitTopMouldBean"
		parameterClass="java.util.Map">
		SELECT
		MOULD_NAME AS mouldName
		FROM QT1TBLTOPTMPT
		WHERE AGENCY_ID=#agencyId#
		AND STATUS ='1'
	</select>

	<!-- 获得某一机构分配的数量 -->
	<select id="checkDistr" resultClass="java.lang.Integer"
		parameterClass="java.util.Map">
		SELECT
		COUNT(*)
		FROM QT1TBLORGSPLITTMPT
		WHERE AGENCY_ID=#agencyId#
		AND MOULD_NAME = #noName#
	</select>

	<!-- 判断是否已经将某模板分配给某个子系统 -->
	<select id="checkDistrMould" resultClass="java.lang.Integer"
		parameterClass="java.util.Map">
		SELECT
		COUNT(*)
		FROM QT1TBLORGSPLITTMPT
		WHERE AGENCY_ID=#agencyId#
		AND RULE_ID = #ruleId#
		AND MOULD_NAME = #noName#
	</select>

	<!-- 判断顶级机构添加模板的时候是否重名 -->
	<select id="checkTopMouldDup" resultClass="java.lang.Integer"
		parameterClass="java.util.Map">
		SELECT
		COUNT(*)
		FROM QT1TBLTOPTMPT
		WHERE MOULD_NAME = #mouldName#
		AND STATUS ='1'
	</select>

	<!-- 判断上级机构添加模板的时候是否重名 -->
	<select id="checkOrgMouldDup" resultClass="java.lang.Integer"
		parameterClass="java.util.Map">
		SELECT
		COUNT(*)
		FROM QT1TBLORGSPLITTMPT
		WHERE MOULD_NAME = #mouldName#
		AND AGENCY_ID = #agencyId#
	</select>



	<!-- 获得分润模板信息 -->
	<select id="getMoulds" resultClass="SplitMouldBean"
		parameterClass="java.util.Map">
		SELECT
		DISTINCT
		RULE_ID AS ruleId,
		RULE_NUM AS ruleNum,
		RULEBEGIN AS ruleBegin,
		RULEEND AS ruleEnd,
		DEAL_TYPE AS dealType,
		RULEREM AS ruleRem,
		CREATERID AS createrId,
		GETDEALTYPENAMEBYID(DEAL_TYPE) AS dealTypeName,
		SPLITTING_MODE AS splittingMode,
		CASE WHEN SPLITTING_MODE='1' THEN '按笔数分润' WHEN SPLITTING_MODE='2' THEN
		'按金额分润' END AS splittingModeStr,
		SPLITTING_REGIONMODE AS splittingRegionMode,
		CASE WHEN SPLITTING_REGIONMODE='1' THEN '月交易笔数' WHEN
		SPLITTING_REGIONMODE='2' THEN '月交易金额' WHEN SPLITTING_REGIONMODE='3'
		THEN '单笔交易金额' END AS splittingRegionModeStr,
		getUserNameById(CREATERID) as createrIdName,
		CREATEDATE AS createDate
		FROM QT1TBLSPLITTMPT
		WHERE RULE_ID = #ruleId#
		  and DEAL_TYPE IN  ($mouldsDealTypeStr$)
		ORDER BY DEAL_TYPE,RULEBEGIN

	</select>

	<!--上级机构分配模板时 获得分润模板信息 （用于显示） -->
	<select id="getMouldsD" resultClass="SplitMouldBean"
		parameterClass="java.util.Map">
		SELECT
		DISTINCT
		RULE_ID AS ruleId,
		RULE_NUM AS ruleNum,
		RULEBEGIN AS ruleBegin,
		RULEEND AS ruleEnd,
		DEAL_TYPE AS dealType,
		RULEREM AS ruleRem,
		CREATEID AS createrId,
		GETDEALTYPENAMEBYID(DEAL_TYPE) AS dealTypeName,
		SPLITTING_MODE AS splittingMode,
		CASE WHEN SPLITTING_MODE='1' THEN '按笔数分润' WHEN SPLITTING_MODE='2' THEN
		'按金额分润' END AS splittingModeStr,
		SPLITTING_REGIONMODE AS splittingRegionMode,
		CASE WHEN SPLITTING_REGIONMODE='1' THEN '月交易笔数' WHEN
		SPLITTING_REGIONMODE='2' THEN '月交易金额' WHEN SPLITTING_REGIONMODE='3'
		THEN '单笔交易金额' END AS splittingRegionModeStr,
		getUserNameById(CREATEID) as createrIdName,
		CASE WHEN SPLITTING_MODE='1' THEN RULEVALUE WHEN SPLITTING_MODE='2' THEN
		RULEVALUE*100 END AS ruleValue,
		CREATEDT AS createDate,
		VALIDITY_DATE AS validityDate
		FROM QT1TBLORGSPLITTMPT
		WHERE RULE_ID = #ruleId#
		AND MOULD_NAME = #mouldName#
		AND AGENCY_ID = #agencyId#
		ORDER BY DEAL_TYPE,RULEBEGIN
	</select>

	<!--上级机构分配模板时 获得分润模板信息 （用于传递） -->
	<select id="getMouldsDT" resultClass="SplitMouldBean"
		parameterClass="java.util.Map">
		SELECT
		DISTINCT
		RULE_ID AS ruleId,
		RULE_NUM AS ruleNum,
		RULEBEGIN AS ruleBegin,
		RULEEND AS ruleEnd,
		DEAL_TYPE AS dealType,
		RULEREM AS ruleRem,
		CREATEID AS createrId,
		GETDEALTYPENAMEBYID(DEAL_TYPE) AS dealTypeName,
		SPLITTING_MODE AS splittingMode,
		CASE WHEN SPLITTING_MODE='1' THEN '按笔数分润' WHEN SPLITTING_MODE='2' THEN
		'按金额分润' END AS splittingModeStr,
		SPLITTING_REGIONMODE AS splittingRegionMode,
		CASE WHEN SPLITTING_REGIONMODE='1' THEN '月交易笔数' WHEN
		SPLITTING_REGIONMODE='2' THEN '月交易金额' WHEN SPLITTING_REGIONMODE='3'
		THEN '单笔交易金额' END AS splittingRegionModeStr,
		getUserNameById(CREATEID) as createrIdName,
		RULEVALUE AS ruleValue,
		CREATEDT AS createDate,
		VALIDITY_DATE AS validityDate
		FROM QT1TBLORGSPLITTMPT
		WHERE RULE_ID = #ruleId#
		AND MOULD_NAME = #mouldName#
		AND AGENCY_ID = #agencyId#
		ORDER BY DEAL_TYPE,RULEBEGIN

	</select>

	<!-- 获得机构分润模板信息 -->
	<select id="getOrgMoulds" resultClass="SplitOrgMouldBean"
		parameterClass="java.util.Map">
		SELECT
		DISTINCT
		RULE_ID AS ruleId,
		RULE_NUM AS ruleNum,
		RULEBEGIN AS ruleBegin,
		RULEEND AS ruleEnd,
		DEAL_TYPE AS dealType,
		GETDEALTYPENAMEBYID(DEAL_TYPE) AS dealTypeName,
		RULEREM AS ruleRem,
		CREATEID AS createrId,
		AGENCY_ID as agencyId,
		CASE WHEN SPLITTING_MODE='1' THEN RULEVALUE WHEN SPLITTING_MODE='2' THEN
		RULEVALUE*100 END AS ruleValue,
		VALIDITY_DATE as validityDate,
		CREATEDT as createDate,
		MOULD_NAME AS mouldName,
		SPLITTING_MODE AS splittingMode,
		CASE WHEN SPLITTING_MODE='1' THEN '按笔数分润' WHEN SPLITTING_MODE='2' THEN
		'按金额分润' END AS splittingModeStr,
		SPLITTING_REGIONMODE AS splittingRegionMode,
		CASE WHEN SPLITTING_REGIONMODE='1' THEN '月交易笔数' WHEN
		SPLITTING_REGIONMODE='2' THEN '月交易金额' WHEN SPLITTING_REGIONMODE='3'
		THEN '单笔交易金额' END AS splittingRegionModeStr,
		getUserNameById(CREATEID) as createrIdName
		FROM QT1TBLORGSPLITTMPT T1
		WHERE AGENCY_ID = #agencyId#
		<isNotEmpty property="ruleId">
			AND RULE_ID = #ruleId#
		</isNotEmpty>
		<isNotEmpty property="mouldName">
			AND MOULD_NAME = #mouldName#
		</isNotEmpty>
		ORDER BY DEAL_TYPE,RULEBEGIN

	</select>

	<!-- 获得已经添加过的机构分润模板信息 -->
	<select id="getAddedOrgMoulds" resultClass="SplitOrgMouldBean"
		parameterClass="java.util.Map">
		SELECT
		DISTINCT
		RULE_ID AS ruleId,
		AGENCY_ID as agencyId,
		GETAGENCYNAMEBYID(AGENCY_ID) AS agencyName,
		MOULD_NAME AS mouldName ,
		VALIDITY_DATE AS validityDate
		FROM QT1TBLORGSPLITTMPT
		WHERE AGENCY_ID = #agencyId#
		<isNotEmpty property="mouldName">
			AND MOULD_NAME = #mouldName#
		</isNotEmpty>
	</select>

	<!-- 根据模板ruleNum,ruleID,mouldName,agencyId，获得机构分润模板表中的值 -->
	<select id="getOrgValue" resultClass="java.lang.Integer"
		parameterClass="java.util.Map">
		SELECT
		DISTINCT
		RULEVALUE AS ruleValue
		FROM QT1TBLORGSPLITTMPT
		WHERE RULE_NUM = #ruleNum#
		<isNotEmpty property="mouldName">
			AND MOULD_NAME = #mouldName#
		</isNotEmpty>
		<isNotEmpty property="ruleId">
			AND RULE_ID = #ruleId#
		</isNotEmpty>
		<isNotEmpty property="agencyId">
			AND AGENCY_ID = #agencyId#
		</isNotEmpty>
	</select>

	<!-- 根据模板ruleNum,ruleID,mouldName,agencyId，获得机构分润模板表中的生效日期 -->
	<select id="getOrgValidityDate" resultClass="java.lang.String"
		parameterClass="java.util.Map">
		SELECT
		DISTINCT
		VALIDITY_DATE AS validityDate
		FROM QT1TBLORGSPLITTMPT
		WHERE RULE_NUM = #ruleNum#
		<isNotEmpty property="mouldName">
			AND MOULD_NAME = #mouldName#
		</isNotEmpty>
		<isNotEmpty property="ruleId">
			AND RULE_ID = #ruleId#
		</isNotEmpty>
		<isNotEmpty property="agencyId">
			AND AGENCY_ID = #agencyId#
		</isNotEmpty>
	</select>

	<!-- 添加顶级分润模板 -->
	<insert id="addTopMould" parameterClass="SplitTopMouldBean">
		INSERT INTO QT1TBLTOPTMPT
		(RULE_ID,
		AGENCY_ID,
		RULEREM,
		MOULD_NAME,
		STATUS)
		VALUES(
		#ruleId#,
		#agencyId#,
		#ruleRem#,
		#mouldName#,
		#status#
		)
	</insert>

	<!-- 修改顶级模板 -->
	<update id="updateTopMould" parameterClass="SplitTopMouldBean">
		UPDATE
		QT1TBLTOPTMPT SET
		RULE_ID=#ruleId#
		<isNotEmpty property="mouldName">
			,MOULD_NAME = #mouldName#
		</isNotEmpty>

		<isNotEmpty property="agencyId">
			,AGENCY_ID = #agencyId#
		</isNotEmpty>
		<isNotEmpty property="ruleRem">
			,RULEREM = #ruleRem#
		</isNotEmpty>
		<isNotEmpty property="status">
			,status = #status#
		</isNotEmpty>

		WHERE
		RULE_ID=#ruleId#
		<isNotEmpty property="agencyId">
			and AGENCY_ID = #agencyId#
		</isNotEmpty>
	</update>

	<!-- 修改顶级模板 -->
	<update id="updateTopMouldD" parameterClass="SplitTopMouldBean">
		UPDATE
		QT1TBLTOPTMPT SET
		MOULD_NAME = #mouldName#,
		<isNotEmpty property="ruleId">
			RULE_ID = #ruleId#,
		</isNotEmpty>
		RULEREM = #ruleRem#
		WHERE
		AGENCY_ID = #agencyId#
	</update>


	<!-- 更新机构分润模板的值 -->
	<update id="updateOrgMouldData" parameterClass="SplitOrgMouldBean">
		UPDATE
		QT1TBLORGSPLITTMPT SET
		AGENCY_ID = #agencyId#,
		<isNotEmpty property="validityDate">
			VALIDITY_DATE = #validityDate#,
		</isNotEmpty>
		<isNotEmpty property="createId">
			CREATEID = #createId#,
		</isNotEmpty>
		CREATEDT = #createDate#,
		RULEVALUE = #ruleValue#
		WHERE
		RULE_ID=#ruleId#
		AND RULE_NUM=#ruleNum#
		AND
		MOULD_NAME=#mouldName#
		AND AGENCY_ID=#agencyId#
	</update>

	<!-- 添加分润模板 -->
	<insert id="addMould" parameterClass="SplitMouldBean">
		INSERT INTO QT1TBLSPLITTMPT
		(RULE_ID,
		DEAL_TYPE,
		SPLITTING_MODE,
		SPLITTING_REGIONMODE,
		RULEBEGIN,
		CREATERID,
		CREATEDATE,
		RULEREM,
		RULE_NUM,
		RULEEND)
		VALUES(
		#ruleId#,
		#dealType#,
		#splittingMode#,
		#splittingRegionMode#,
		#ruleBegin#,
		#createrId#,
		#createDate#,
		#ruleRem#,
		#ruleNum#,
		#ruleEnd#
		)
	</insert>

	<!-- 添加机构分润模板 -->
	<insert id="addOrgMould" parameterClass="java.util.Map">
		INSERT INTO QT1TBLORGSPLITTMPT
		(RULE_ID,
		AGENCY_ID,
		DEAL_TYPE,
		SPLITTING_MODE,
		SPLITTING_REGIONMODE,
		RULEBEGIN,
		RULEEND,
		CREATEID,
		CREATEDT,
		RULEREM,
		RULE_NUM,
		RULEVALUE,
		VALIDITY_DATE,
		MOULD_NAME)
		VALUES(
		#ruleId#,
		#agencyId#,
		#dealType#,
		#splittingMode#,
		#splittingRegionMode#,
		#ruleBegin#,
		#ruleEnd#,
		#createrId#,
		#createDate#,
		#ruleRem#,
		#ruleNum#,
		#ruleValue#,
		#validityDate#,
		#mouldName#
		)
	</insert>

	<!-- 添加机构分润模板 -->
	<insert id="addOrgMouldData" parameterClass="SplitOrgMouldBean">
		INSERT INTO QT1TBLORGSPLITTMPT
		(RULE_ID,
		AGENCY_ID,
		DEAL_TYPE,
		SPLITTING_MODE,
		SPLITTING_REGIONMODE,
		RULEBEGIN,
		RULEEND,
		CREATEID,
		CREATEDT,
		RULEREM,
		RULE_NUM,
		RULEVALUE,
		VALIDITY_DATE,
		MOULD_NAME)
		VALUES(
		#ruleId#,
		#agencyId#,
		#dealType#,
		#splittingMode#,
		#splittingRegionMode#,
		#ruleBegin#,
		#ruleEnd#,
		#createId#,
		#createDate#,
		#ruleRem#,
		#ruleNum#,
		#ruleValue#,
		#validityDate#,
		#mouldName#
		)
	</insert>

	<!-- 更新分润模板 -->
	<update id="updateMould" parameterClass="SplitMouldBean">
		UPDATE QT1TBLSPLITTMPT
		SET
		RULE_ID = #ruleId#,
		DEAL_TYPE = #dealType#,
		SPLITTING_MODE = #splittingMode#,
		SPLITTING_REGIONMODE = #splittingRegionMode#,
		RULEBEGIN = #ruleBegin#,
		RULEEND = #ruleEnd#,
		CREATERID = #createrId#,
		CREATEDATE = #createDate#,
		RULEREM = #ruleRem#
		WHERE RULE_NUM = #ruleNum#
	</update>

	<!-- 删除顶级分润模板 -->
	<update id="delTopMould" parameterClass="java.util.Map">
		UPDATE QT1TBLTOPTMPT
		SET STATUS = '0'
		WHERE RULE_ID=#ruleId# and agency_id=#agencyId#
	</update>

	<!-- 删除分润模板中的某一条 -->
	<delete id="delRule" parameterClass="java.util.Map">
		delete from QT1TBLSPLITTMPT
		where RULE_NUM=#ruleNum#
	</delete>


	<!-- 删除分润模板 -->
	<delete id="delMould" parameterClass="java.util.Map">
		delete from QT1TBLSPLITTMPT
		where RULE_ID=#ruleId#
	</delete>

	<!-- 删除机构分润模板 -->
	<delete id="deleteOrgMould" parameterClass="java.util.Map">
		delete from
		QT1TBLORGSPLITTMPT
		WHERE RULE_ID = #ruleId#
		AND MOULD_NAME = #mouldName#
		AND AGENCY_ID = #agencyId#
	</delete>

	<!-- 顶级机构获得模板分配信息 -->
	<select id="getDistrMouldsD" resultClass="SplitMouldBean"
		parameterClass="java.util.Map">
		SELECT
		RULE_ID AS ruleId,
		RULE_NUM AS ruleNum,
		RULEBEGIN AS ruleBegin,
		RULEEND AS ruleEnd,
		DEAL_TYPE AS dealType,
		GETDEALTYPENAMEBYID(DEAL_TYPE) AS dealTypeName,
		RULEREM AS ruleRem,
		CREATEID AS createrId,
		AGENCY_ID as agencyId,
		CASE WHEN SPLITTING_MODE='1' THEN RULEVALUE WHEN SPLITTING_MODE='2' THEN
		RULEVALUE*100 END AS ruleValue,
		VALIDITY_DATE as validityDate,
		CREATEDT as createDate,
		SPLITTING_MODE AS splittingMode,
		MOULD_NAME AS mouldName,
		CASE WHEN SPLITTING_MODE='1' THEN '按笔数分润' WHEN SPLITTING_MODE='2' THEN
		'按金额分润' END AS splittingModeStr,
		SPLITTING_REGIONMODE AS splittingRegionMode,
		CASE WHEN SPLITTING_REGIONMODE='1' THEN '月交易笔数' WHEN
		SPLITTING_REGIONMODE='2' THEN '月交易金额' WHEN SPLITTING_REGIONMODE='3'
		THEN '单笔交易金额' END AS splittingRegionModeStr,
		getUserNameById(CREATEID) as createrIdName
		FROM QT1TBLORGSPLITTMPT
		WHERE AGENCY_ID = #agencyId#
		<isNotEmpty property="ruleId">
			AND RULE_ID = #ruleId#
		</isNotEmpty>
		AND MOULD_NAME = #noName#
		AND DEAL_TYPE NOT IN('11', '16')
		ORDER BY DEAL_TYPE,RULEBEGIN
	</select>

	<!-- 获得模板分配信息 -->
	<select id="getDistrMoulds" resultClass="SplitTopMouldBean"
		parameterClass="java.util.Map">
		SELECT
		DISTINCT
		T2.AGENCY_ID AS agencyId,
		GETAGENCYNAMEBYID(#agencyId#) AS agencyName,
		GETAGENCYNAMEBYID(T2.AGENCY_ID) AS agencyNameD,
		T1.RULE_ID AS ruleId,
		T1.RULEREM AS ruleRem,
		T1.MOULD_NAME AS MouldName,
		T1.status AS status
		FROM QT1TBLTOPTMPT T1,
		(SELECT
		AGENCY_ID
		FROM rtb_qt1tblagency
		WHERE AGENCY_STATUS ='2'   <!-- 2 表示该机构已经审核通过 -->
		AND ONLINECHANNEL =#agencyId#) T2
		WHERE T1.AGENCY_ID = T2.AGENCY_ID

		<isNotEmpty property="mouldName">
			AND T1.MOULD_NAME=#mouldName#
		</isNotEmpty>
		<isNotEmpty property="status">
			AND T1.status=#status#
		</isNotEmpty>
	</select>

	<!-- 获得可供选择的模板 -->
	<select id="getSelectMoulds" resultClass="SplitTopMouldBean"
		parameterClass="java.util.Map">
		SELECT
		DISTINCT
		T1.AGENCY_ID AS agencyId,
		GETAGENCYNAMEBYID(T2.ONLINECHANNEL) AS agencyName,
		GETAGENCYNAMEBYID(T1.AGENCY_ID) AS agencyNameD,
		T1.RULE_ID AS ruleId,
		T1.RULEREM AS ruleRem,
		T1.MOULD_NAME AS MouldName
		FROM QT1TBLTOPTMPT T1,
		(SELECT
		ONLINECHANNEL
		FROM rtb_qt1tblagency
		WHERE AGENCY_STATUS ='2'   <!-- 2 表示该机构已经审核通过 -->
		AND AGENCY_ID =#agencyId#) T2
		WHERE T1.AGENCY_ID = #agencyId# and t1.status='1'

	</select>

	<!-- 添加机构分润历史表 -->
	<insert id="addHisMould" parameterClass="java.util.Map">
		INSERT INTO QT1TBLSPLITTMPTHIS
		(RULE_ID,
		AGENCY_ID,
		DEAL_TYPE,
		SPLITTING_MODE,
		SPLITTING_REGIONMODE,
		RULEBEGIN,
		RULEEND,
		CREATEID,
		CREATEDT,
		RULEREM,
		RULE_NUM,
		RULEVALUE,
		INVALIDITY_DATE,
		MOULD_NAME,
		VALIDITY_DATE)
		VALUES(
		#ruleId#,
		#agencyId#,
		#dealType#,
		#splittingMode#,
		#splittingRegionMode#,
		#ruleBegin#,
		#ruleEnd#,
		#createrId#,
		#createDate#,
		#ruleRem#,
		#ruleNum#,
		#ruleValue#,
		#invalidityDate#,
		#mouldName#,
		#mvalidityDate#)
	</insert>

	<!-- 添加机构分润历史表 (分配查看时) -->
	<insert id="addHisMouldD" parameterClass="java.util.Map">
		INSERT INTO QT1TBLSPLITTMPTHIS
		(RULE_ID,
		AGENCY_ID,
		DEAL_TYPE,
		SPLITTING_MODE,
		SPLITTING_REGIONMODE,
		RULEBEGIN,
		RULEEND,
		CREATEID,
		CREATEDT,
		RULEREM,
		RULE_NUM,
		RULEVALUE,
		INVALIDITY_DATE,
		MOULD_NAME)
		VALUES(
		#ruleId#,
		#agencyId#,
		#dealType#,
		#splittingMode#,
		#splittingRegionMode#,
		#ruleBegin#,
		#ruleEnd#,
		#createrId#,
		#createDate#,
		#ruleRem#,
		#ruleNum#,
		#ruleValue#,
		#invalidityDate#,
		#mouldName#
		)
	</insert>

	<!--判断是否已有这一条模板 -->
	<select id="getMouldCount" parameterClass="java.util.Map"
		resultClass="java.lang.Integer">
		SELECT
		COUNT(1)
		FROM
		(
		SELECT
		*
		FROM
		QT1TBLSPLITTMPT
		where AGENCY_ID=#agencyId#
		and CHILD_AGENCY_ID=#childAgencyId#
		and DEAL_TYPE=#dealType#
		)
	</select>


	<!-- 删除的时候增加历史记录 -->
	<insert id="addDelHis" parameterClass="SplitOrgMouldBean">
		INSERT INTO QT1TBLSPLITTMPTHIS
		(RULE_ID,
		AGENCY_ID,
		DEAL_TYPE,
		SPLITTING_MODE,
		SPLITTING_REGIONMODE,
		RULEBEGIN,
		RULEEND,
		CREATEID,
		CREATEDT,
		RULEREM,
		RULE_NUM,
		RULEVALUE,
		VALIDITY_DATE,
		MOULD_NAME,
		INVALIDITY_DATE)
		VALUES(
		#ruleId#,
		#agencyId#,
		#dealType#,
		#splittingMode#,
		#splittingRegionMode#,
		#ruleBegin#,
		#ruleEnd#,
		#createId#,
		#createDate#,
		#ruleRem#,
		#ruleNum#,
		#ruleValue#,
		#validityDate#,
		#mouldName#,
		#invalidiayDate#
		)
	</insert>
	
	<select id="queryMouldRulevalueUpper" parameterClass="java.util.Map" resultClass="java.lang.Double">
	select distinct max(rulevalue) from QT1TBLORGSPLITTMPT t where t.agency_id = #agencyId# 
    and t.deal_type =#dealType# and t.splitting_mode =#splittingMode# and t.splitting_regionmode = #splittingRegionmode# and t.mould_name = 'UUUUU'
	</select>
	
</sqlMap>